{"ast":null,"code":"import _regeneratorRuntime from \"/home/jackson/Desktop/crm-ticket/crm-ticket/CrmFrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/jackson/Desktop/crm-ticket/crm-ticket/CrmFrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport axios from \"axios\";\nvar rootUrl = \"http://localhost:3001/v1/\";\nvar userProfileUrl = rootUrl + \"user\";\nvar loginUrl = 'http://localhost:3001/v1/user/login';\nvar logoutUrl = 'http://localhost:3001/v1/user/logout';\nvar newAccessJWT = 'http://localhost:3001/v1/token';\nexport var userLogin = function userLogin(frmData) {\n  return new Promise( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve, reject) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.post(loginUrl, frmData);\n            case 3:\n              res = _context.sent;\n              console.log(res);\n              resolve(res.data);\n              if (res.data.status === \"success\") {\n                sessionStorage.setItem(\"accessJWT\", res.data.accessJWT);\n                localStorage.setItem(\"crmSite\", JSON.stringify({\n                  refreshJWT: res.data.RefreshJwt\n                }));\n              }\n              _context.next = 12;\n              break;\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              reject(_context.t0);\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9]]);\n    }));\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n};\nexport var fetchUser = function fetchUser() {\n  return new Promise( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resolve, reject) {\n      var accessJWT, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              accessJWT = sessionStorage.getItem(\"accessJWT\");\n              if (!accessJWT) {\n                reject(\"Token not found!\");\n              }\n              _context2.next = 5;\n              return axios.get(userProfileUrl, {\n                headers: {\n                  authorization: accessJWT\n                }\n              });\n            case 5:\n              res = _context2.sent;\n              resolve(res.data);\n              _context2.next = 13;\n              break;\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n              reject(_context2.t0.message);\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n    return function (_x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n};\nexport var userLogout = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return axios.delete(logoutUrl, {\n              headers: {\n                Authorization: sessionStorage.getItem(\"accessJWT\")\n              }\n            });\n          case 3:\n            _context3.next = 8;\n            break;\n          case 5:\n            _context3.prev = 5;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(_context3.t0);\n          case 8:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[0, 5]]);\n  }));\n  return function userLogout() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var fetchNewAccessJWT = function fetchNewAccessJWT() {\n  return new Promise( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(resolve, reject) {\n      var _JSON$parse, refreshJWT, res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _JSON$parse = JSON.parse(localStorage.getItem(\"crmSite\")), refreshJWT = _JSON$parse.refreshJWT;\n              console.log(refreshJWT);\n              if (!refreshJWT) {\n                reject(\"Token not found!\");\n              }\n              _context4.next = 6;\n              return axios.get(newAccessJWT, {\n                headers: {\n                  authorization: refreshJWT\n                }\n              });\n            case 6:\n              res = _context4.sent;\n              if (res.data.status === \"success\") {\n                sessionStorage.setItem(\"accessJWT\", res.data.accessJWT);\n              }\n              resolve(true);\n              _context4.next = 15;\n              break;\n            case 11:\n              _context4.prev = 11;\n              _context4.t0 = _context4[\"catch\"](0);\n              // if (error.message === \"Request failed with status code 403\") {\n              //   localStorage.removeItem(\"crmSite\");\n\n              cons;\n              reject(false);\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 11]]);\n    }));\n    return function (_x5, _x6) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n};","map":{"version":3,"names":["axios","rootUrl","userProfileUrl","loginUrl","logoutUrl","newAccessJWT","userLogin","frmData","Promise","resolve","reject","post","res","console","log","data","status","sessionStorage","setItem","accessJWT","localStorage","JSON","stringify","refreshJWT","RefreshJwt","fetchUser","getItem","get","headers","authorization","message","userLogout","delete","Authorization","fetchNewAccessJWT","parse","cons"],"sources":["/home/jackson/Desktop/crm-ticket/crm-ticket/CrmFrontEnd/src/api/userApi.js"],"sourcesContent":["import axios from \"axios\";\nconst rootUrl = \"http://localhost:3001/v1/\";\nconst userProfileUrl = rootUrl + \"user\";\n\nconst loginUrl ='http://localhost:3001/v1/user/login'\n\nconst logoutUrl ='http://localhost:3001/v1/user/logout'\n\nconst newAccessJWT ='http://localhost:3001/v1/token'\n\nexport const userLogin = (frmData) => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const res = await axios.post(loginUrl, frmData);\n        console.log(res)\n        \n        \n        resolve(res.data);\n  \n        if (res.data.status === \"success\") {\n          sessionStorage.setItem(\"accessJWT\", res.data.accessJWT);\n          localStorage.setItem(  \"crmSite\",JSON.stringify({ refreshJWT: res.data.RefreshJwt }) );\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  };\n  export const fetchUser = () => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const accessJWT = sessionStorage.getItem(\"accessJWT\");\n  \n        if (!accessJWT) {\n          reject(\"Token not found!\");\n        }\n  \n        const res = await axios.get(userProfileUrl, {\n          headers: {\n            authorization: accessJWT,\n          },\n        });\n  \n        resolve(res.data);\n      } catch (error) {\n        console.log(error);\n        reject(error.message);\n      }\n    });\n  };\n  \n  export const userLogout = async () => {\n    try {\n      await axios.delete(logoutUrl, {\n        headers: {\n          Authorization: sessionStorage.getItem(\"accessJWT\"),\n        },\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  export const fetchNewAccessJWT = () => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { refreshJWT } = JSON.parse(localStorage.getItem(\"crmSite\"));\n\n        console.log(refreshJWT)\n  \n        if (!refreshJWT) {\n          reject(\"Token not found!\");\n        }\n  \n        const res = await axios.get(newAccessJWT, {\n          headers: {\n            authorization: refreshJWT,\n          },\n        });\n  \n        if (res.data.status === \"success\") {\n          sessionStorage.setItem(\"accessJWT\", res.data.accessJWT);\n        }\n  \n        resolve(true);\n      } catch (error) {\n        // if (error.message === \"Request failed with status code 403\") {\n        //   localStorage.removeItem(\"crmSite\");\n\n    cons\n       \n        reject(false);\n      }\n    });\n  };"],"mappings":"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"},"metadata":{},"sourceType":"module"}